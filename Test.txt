Date getLastDeactivationDate(String username) {
    def auditSearchService = ComponentAccessor.getOSGiComponentInstanceOfType(AuditSearchService)

    def offset = 0
    def limit = 1000 // Anzahl der Audit-Log-Einträge zum Durchsuchen (falls nötig anpassen)

    def records = auditSearchService.getRecords(offset, limit)
        .findAll { AuditEntity entity ->
            entity.getAuditType().getName() == "User deactivated" &&
            entity.getAffectedObjects().any { AuditResource resource ->
                resource.getName() == username
            }
        }
        .sort { a, b -> b.getCreated().toEpochMilli() <=> a.getCreated().toEpochMilli() }

    if (records) {
        return Date.from(records.first().getCreated().atZone(ZoneId.systemDefault()).toInstant())
    }

    return null
}
