Date getLastUserDeactivationDate(String username) {
    def auditSearchService = ComponentAccessor.getOSGiComponentInstanceOfType(AuditSearchService)

    def auditQuery = AuditQuery.builder()
        .searchText("User deactivated")
        .build()

    def pageRequest = new PageRequest.Builder<AuditEntityCursor>()
        .offset(0)
        .limit(500)
        .build()

    def results = auditSearchService.findBy(auditQuery, pageRequest)

    // Filter results by username (affected object)
    def userDeactivationDates = results.values.findAll { AuditEntity entity ->
        entity.affectedObjects.any { affectedObject ->
            affectedObject.name.equalsIgnoreCase(username)
        }
    }.collect { entity ->
        entity.created
    }

    // Find latest date or null if no deactivation occurred
    return userDeactivationDates ? Date.from(userDeactivationDates.max()) : null
}
